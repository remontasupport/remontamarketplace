generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ContractorProfile {
  id                            String    @id @default(cuid())
  zohoContactId                 String    @unique

  // Basic Information
  firstName                     String
  lastName                      String
  email                         String    @unique
  phone                         String?
  gender                        String?   // Gender from Zoho

  // Location
  city                          String?
  state                         String?
  postalZipCode                 String?
  latitude                      Float?    // Geocoded latitude for distance calculations
  longitude                     Float?    // Geocoded longitude for distance calculations

  // Professional Details
  titleRole                     String?
  yearsOfExperience             Int?
  aboutYou                      String?   // Bio/description about the contractor

  // Qualifications & Skills
  qualificationsAndCertifications String?
  languageSpoken                String?
  hasVehicleAccess              Boolean?

  // Personal Details
  funFact                       String?
  hobbiesAndInterests           String?
  whatMakesBusinessUnique       String?
  additionalInformation         String?

  // Profile Image
  profilePicture                String?   // Vercel Blob URL (from Zoho Record_Image/photo)

  // System Fields
  lastSyncedAt                  DateTime  @default(now())
  createdAt                     DateTime  @default(now())
  updatedAt                     DateTime  @updatedAt
  deletedAt                     DateTime? // Soft delete - null means active, non-null means deleted

  // ============================================
  // PRODUCTION-READY INDEXES
  // ============================================
  // These indexes dramatically improve query performance at scale

  @@index([email])
  @@index([zohoContactId])
  @@index([deletedAt]) // Index for filtering deleted records (used in all queries)

  // Location indexes for search optimization
  @@index([city])
  @@index([state])
  @@index([postalZipCode])
  @@index([latitude, longitude]) // Composite index for geo-location queries

  // Filter indexes for common search parameters
  @@index([gender]) // Index for gender filtering
  @@index([titleRole]) // Index for support type filtering

  // Composite indexes for common filter combinations
  @@index([deletedAt, city]) // Common: active contractors in a city
  @@index([deletedAt, state]) // Common: active contractors in a state
  @@index([deletedAt, gender]) // Common: active contractors by gender
  @@index([deletedAt, titleRole]) // Common: active contractors by role
  @@index([deletedAt, latitude, longitude]) // Common: active contractors with coordinates
}

model Job {
  id                        String    @id @default(cuid())
  zohoId                    String    @unique // Zoho Deal ID

  // Basic Job Information
  dealName                  String    // Deal_Name from Zoho
  title                     String?   // Job_Title (custom field if exists)
  description               String?   // Description from Zoho
  stage                     String    // Current stage in Zoho (e.g., "Matching")

  // Location Information
  suburbs                   String?   // Suburbs from Zoho
  state                     String?   // State from Zoho (QLD, NSW, etc.)

  // Service Information
  serviceAvailed            String?   // Service_Availed (e.g., "Support Work")
  serviceRequirements       String?   // Service_Requirements (e.g., "Female")

  // Additional Requirements
  disabilities              String?   // Disabilities from Zoho
  behaviouralConcerns       String?   // Behavioural_Concerns from Zoho
  culturalConsiderations    String?   // Cultural_Considerations from Zoho
  language                  String?   // Language requirements
  religion                  String?   // Religion from Zoho

  // Personal Preferences
  age                       String?   // Age from Zoho (can be number or range like "18-30")
  gender                    String?   // Gender preferences
  hobbies                   String?   // Hobbies from Zoho

  // Client Information (from Client_Name lookup)
  clientName                String?   // Client name
  clientZohoId              String?   // Client's Zoho Contact ID
  relationshipToParticipant String?   // Relationship_to_Participant (e.g., "SC")

  // Owner Information
  ownerName                 String?   // Deal owner name
  ownerEmail                String?   // Deal owner email
  ownerZohoId               String?   // Deal owner Zoho ID

  // Dates
  postedAt                  DateTime? // When job was posted (Created_Time from Zoho)

  // Status & Visibility
  active                    Boolean   @default(true) // Controls frontend visibility

  // Additional Fields
  requiredMoreWorker        Boolean?  // Required_More_Worker from Zoho
  anotherContractorNeeded   Boolean?  // Another_Contractor_Needed from Zoho

  // System Fields
  lastSyncedAt              DateTime  @default(now()) // Last sync from Zoho
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt

  // ============================================
  // PRODUCTION-READY INDEXES
  // ============================================

  @@index([zohoId])
  @@index([active]) // Most important: filter active jobs
  @@index([stage]) // Filter by stage

  // Location indexes for search
  @@index([suburbs])
  @@index([state])

  // Service type filtering
  @@index([serviceAvailed])

  // Date-based queries
  @@index([postedAt])

  // Common filter combinations
  @@index([active, stage]) // Active jobs in specific stage
  @@index([active, state]) // Active jobs in specific state
  @@index([active, suburbs]) // Active jobs in specific suburb
  @@index([active, serviceAvailed]) // Active jobs by service type
  @@index([active, postedAt]) // Active jobs sorted by date

  // Sync management
  @@index([lastSyncedAt]) // Track sync status
}
